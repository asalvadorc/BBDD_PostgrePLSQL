<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://asalvadorc.github.io/BBDD_POSTGREPLSQL/3_declaraci_de_variables/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>3. Declaració de variables - BD - Bases de Dades</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
        <link href="../img/favicon.ico" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "3. Declaraci\u00f3 de variables";
        var mkdocs_page_input_path = "3_declaraci_de_variables.md";
        var mkdocs_page_url = "/BBDD_POSTGREPLSQL/3_declaraci_de_variables/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../assets/logocaminas.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Programació en PostgreSQL</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../objectius_i_coneixements_previs/">Objectius</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../0_nota_inicial/">0. DDL, DML de la BD per als exercicis</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../1_introducci/">1. Introducció</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../2_plpgsql/">2. PL/pgSQL</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">3. Declaració de variables</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../4_instruccions/">4. Instruccions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../5_funcions/">5. Funcions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../6_utilitzaci_de_cursors/">6. Utilització de cursors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../7_missatges_i_excepcions/">7. Missatges</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../8_triggers/">8. Triggers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercicis_de_tot_el_tema/">Exercicis de tot el tema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercicis_repas/">Exercicis de repàs</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">BD - Bases de Dades</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Programació en PostgreSQL</li>
      <li class="breadcrumb-item active">3. Declaració de variables</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3-declaracio-de-variables">3. Declaració de variables</h1>
<p>S'han de declarar totes (excepte les variables comptador dels bucles FOR, com
ja veurem en el seu moment) en el bloc <strong>DECLARE</strong> i els tipus vàlids són els
de SQL (NUMERIC, CHAR, DATE, ...). També es poden declarar de subtipus
definits per l’usuari, com per exemple <strong>lat</strong>.</p>
<p>Aquesta és la sintaxi de declaració de variables:</p>
<pre><code>nom [CONSTANT] tipus [NOT NULL] [{DEFAULT | :=}expressió];
</code></pre>
<p>Com veiem, i de forma opcional podem definir les variables com a:</p>
<ul>
<li>
<p><strong>Constants</strong> , i aleshores el seu contingut no podrà variar (haurà de tenir valor inicial).</p>
</li>
<li>
<p><strong>No nul·les</strong> , i aleshores una assignació del valor nul donarà un error (haurà de tenir valor inicial).</p>
</li>
<li>
<p><strong>Amb un valor inicial</strong> (a les variables declarades com a constants només se'ls podran donar valors amb aquesta clàusula).</p>
</li>
</ul>
<p><strong>Per exemple</strong>:</p>
<pre><code>DECLARE
    v1 VARCHAR;
    v2 CONSTANT TEXT := 'Hola';
    v3 NUMERIC(5) := 0;
    v4 DATE NOT NULL DEFAULT '7-7-77';
    v5 lat;
    vec6 NUMERIC(5)[];
</code></pre>
<p>Si tenim, com en l'últim exemple, una variable que és d'un tipus compost, la
manera d'accedir a un camp serà separant la variable i el camp per un punt:
<strong>v5.h</strong>. Ara no farà falta posar la variable entre parèntesis, com ens tocava
fer en les sentències SQL.</p>
<p>L'àmbit de les variables és el bloc on es declaren i els blocs "fills", és a
dir aquells blocs definits dins del bloc on està definida la variable. Si
se'ls dóna un valor inicial, aquest valor s'assigna cada vegada que s'entra
dins del bloc (no al principi de l'execució de la funció). Això pot ser
important, ja que en la mateixa execució de la funció si s'entra més d'una
vegada en el bloc, pot tenir resultats diferents.</p>
<p>Per exemple: Utilitzem la funció que ja tenim creada <strong>gent_com</strong> (població de
la comarca especificada). La utilitzem per a inicialitzar una variable en el
DECLARE, i executem aquest bloc dues vegades. Només ens queda canviar la
comarca entre les dues passades.</p>
<pre><code>CREATE OR REPLACE FUNCTION moltes_pobl() RETURNS void AS $cos$
DECLARE aux text := 'Marina Alta';
BEGIN
FOR i IN 1..2 LOOP
    DECLARE
        n numeric := gent_com(aux);
    BEGIN
        RAISE NOTICE 'Comarca %: % habitants',aux,n;
    END;
    IF i=1 THEN
        aux:='Marina Baixa';
    END IF;
END LOOP;
END; $cos$
LANGUAGE 'plpgsql';
</code></pre>
<p>I per a veure el resultat:</p>
<pre><code>SELECT moltes_pobl();
</code></pre>
<p>Recordeu que el resultat que traiem amb <strong>RAISE NOTICE</strong> es veu en la pestanya
de <strong>Messages</strong>.</p>
<p>Com veurem un poc més avant, a les funcions se'ls poden passar paràmetres,
però en el moment de definir-los tenim l'opció de posar només de quin tipus
són. La manera de nomenar-los dins de la funció, d'aquesta manera, és <strong>$1</strong> ,
<strong>$2</strong> , ... Per a no haver d'utilitzar uns noms tan impersonals, podem posar
àlies en la zona de declaració:</p>
<pre><code>CREATE OR REPLACE FUNCTION iva(numeric) RETURNS numeric AS '
BEGIN
    RETURN $1 * 0.16;
END; ' LANGUAGE plpgsql;
</code></pre>
<hr />
<pre><code>SELECT iva(200);
</code></pre>
<p>Ja que estem en la zona de declaració de variables, anem a acabar de comentar
la manera de definir variables.</p>
<ul>
<li><strong>%TYPE</strong> permet definir variables del tipus equivalent a una altra variable (<strong>v1 v2%TYPE;</strong>).</li>
</ul>
<blockquote>
<p>La utilitat real és que jo puc definir una variable del mateix tipus que un
camp d'una determinada taula, i no cal que recorde de quin tipus era aquell.
Per exemple:
</p>
<pre><code>v_lat poblacions.lat%TYPE;
</code></pre>
</blockquote>
<ul>
<li><strong>%ROWTYPE</strong> : la variable serà de tipus <strong>fila</strong> de la taula esmentada.</li>
</ul>
<blockquote>
<p>Podrem utilitzar la variable amb camps, ja que equival a tota la fila.</p>
<pre><code>CREATE OR REPLACE FUNCTION loc_pobl(text) RETURNS void AS $cos$
DECLARE f poblacions%ROWTYPE;
BEGIN
    SELECT * INTO f FROM POBLACIONS WHERE nom=$1;
    RAISE NOTICE 'Població: %',f.nom;
    RAISE NOTICE 'Latitud: %',f.latitud;
    RAISE NOTICE 'Longitud: %',f.longitud;
END; $cos$
LANGUAGE 'plpgsql';


SELECT loc_pobl('Llucena');
</code></pre>
</blockquote>
<ul>
<li><strong>RECORD</strong> és també de tipus <strong>fila</strong> , però agafa la seua estructura en el moment d'efectuar-se la sentència select. És per tant molt més versàtil.</li>
</ul>
<blockquote>
<pre><code>CREATE OR REPLACE FUNCTION loc_pobl_2(text) RETURNS void AS $cos$
DECLARE f RECORD;
BEGIN
    SELECT * INTO f FROM POBLACIONS WHERE nom=$1;
    RAISE NOTICE 'Població: %',f.nom;
    RAISE NOTICE 'Latitud: %',f.latitud;
    RAISE NOTICE 'Longitud: %',f.longitud;
END; $cos$
LANGUAGE 'plpgsql';


SELECT loc_pobl_2('Llucena');
</code></pre>
</blockquote>
<p>Llicenciat sota la  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Llicència Creative Commons Reconeixement NoComercial
CompartirIgual 3.0</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../2_plpgsql/" class="btn btn-neutral float-left" title="2. PL/pgSQL"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../4_instruccions/" class="btn btn-neutral float-right" title="4. Instruccions">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../2_plpgsql/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../4_instruccions/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
